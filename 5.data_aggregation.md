## Задача 1

*Для начала решим простую задачу: выведите id всех уникальных пользователей из таблицы user_actions.*  
*Результат отсортируйте по возрастанию id.*

```sql
select distinct user_id 
from user_actions
order by 1;
```

## Задача 2

*Примените DISTINCT сразу к двум колонкам таблицы courier_actions и отберите уникальные пары значений courier_id и order_id.*  
*Результат отсортируйте по двум колонкам по возрастанию сначала id курьера, затем id заказа.*

```sql
select 
  distinct courier_id, order_id
from courier_actions
order by 1, 2;
```

## Задача 3

*Посчитайте максимальную и минимальную цены товаров в таблице products.*  
*Поля назовите соответственно max_price, min_price.*

```sql
select
  max(price) as max_price,
  min(price) as min_price
from products;
```

## Задача 4

*С помощью COUNT(DISTINCT) посчитайте количество уникальных пользователей сервиса, количество уникальных заказов, поделите одно на другое и рассчитайте, сколько заказов приходится на одного пользователя.*  
*Показатель числа заказов на пользователя округлите до двух знаков после запятой при помощи функции ROUND, которую мы рассматривали в этой задаче.*  
*В результирующей таблице отобразите все три значения — поля назовите соответственно unique_users, unique_orders, orders_per_user.*  
*Все расчёты проведите на основе таблицы user_actions.*

```sql
select 
  *, 
  round(1.0 * unique_orders / unique_users, 2) as orders_per_user from 
  ( select
      count(distinct user_id) as unique_users,
      count(distinct order_id) as unique_orders
   from user_actions
  ) foo;
```

## Задача 5

*Посчитайте количество курьеров женского пола в таблице couriers.*  
*Полученный столбец назовите couriers_count.*

```sql
select 
  count(*) as couriers_count 
from couriers
where sex = 'female';
```

## Задача 6

*Посчитайте количество заказов в таблице orders с девятью и более товарами.*  
*Для этого воспользуйтесь функцией array_length, отфильтруйте данные по количеству товаров в заказе и проведите агрегацию.*  
*Полученный столбец назовите orders_count.*

```sql
select count(*) as orders_count from (
  select 
    order_id
  from orders
  where array_length(product_ids, 1) >= 9
  ) t;
```

## Задача 7

*Рассчитайте среднюю цену товаров в таблице products, в названиях которых присутствуют слова «чай» и «кофе».*  
*Любым известным способом исключите из расчёта «иван-чай» и «чайный гриб».*  
*Среднюю цену округлите до двух знаков после запятой.*  
*Столбец с полученным значением назовите avg_price.*

```sql
select 
  round(avg(price), 2) as avg_price 
from products
where name similar to '%(чай|кофе)%'
and name not similar to '%(иван-чай|чайный гриб)%';
```

## Задача 8

*С помощью функции AGE() и агрегирующей функции рассчитайте возраст самого молодого курьера мужского пола в таблице couriers.*  
*Возраст измерьте количеством лет, месяцев и дней (как в примере) и переведите его в тип VARCHAR.*  
*В качестве даты, относительно которой считать возраст, используйте свою текущую дату (либо не указывайте её вовсе, как показано в примерах).*  
*Полученную колонку со значением возраста назовите min_age.*

```sql
select 
  age(current_date, birth_date)::varchar as min_age 
from couriers
where sex = 'male'
order by age(current_date, birth_date)
limit 1;
```

## Задача 9

*Снова воспользуйтесь функцией AGE() и рассчитайте разницу в возрасте между самым старым и самым молодым пользователями мужского пола в таблице users.*  
*Изменять тип данных колонки с результатом не нужно.*  
*Колонку с посчитанным значением назовите age_diff.*

```sql
select 
  age( max(birth_date), min(birth_date)) as age_diff 
from users
where sex = 'male';
```

## Задача 10

*Давайте представим, что один из молодых пользователей сервиса сделал заказ, в который вошли сухарики, чипсы и энергетический напиток.*  
*Посчитайте стоимость такого заказа.*  
*Колонку с рассчитанной стоимостью заказа назовите order_price.*

```sql
select 
  sum(price) as order_price 
  from products
where name in ('сухарики', 'чипсы', 'энергетический напиток');
```

## Задача 11

*Посчитайте стоимость заказа, в котором будут три пачки сухариков, две пачки чипсов и один энергетический напиток.*  
*Колонку с рассчитанной стоимостью заказа назовите order_price.*

```sql
select 
  sum(case when name = 'сухарики' then price *  3
           when name = 'чипсы' then price *  2
           when name = 'энергетический напиток' then price end) as order_price
from products;
```

## Задача 12

*Посчитайте, сколько пользователей никогда не отменяли свой заказ.*  
*Для этого из общего числа всех уникальных пользователей отнимите число уникальных пользователей, которые хотя бы раз отменяли заказ.*  
*Подумайте, какое условие необходимо указать в FILTER, чтобы получить корректный результат.*  
*Полученный столбец назовите users_count.*

```sql
select
  count(distinct user_id) - 
    count(distinct user_id) filter (where action = 'cancel_order') as users_count
from user_actions;
```